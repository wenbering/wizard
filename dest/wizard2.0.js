function LinearProcessManager(){this._processes=[]}var wizard={adapters:{},handlers:{},steps:{}};wizard.utils=function(){var e={},t=function(){var e=Array.prototype.forEach;return e?function(t,n){e.call(t,n)}:function(e,t){if(t)for(var n=0,a=e.length;a>n;n++)t(e[n],n,e)}}();return t("Boolean Number String Function Array Date RegExp Object Undefined".split(" "),function(t){e["[object "+t+"]"]=t.toLowerCase()}),{formatDiskSizeToGB:function(e){return isNaN(e)?0:parseFloat(e)/1024/1024/1024},adjustBtnGroupLayout:function(e){var t={$parent:{},$buttons:{},maxMargin:30,maxWidth:300,minWidth:146,ratio:.1};t=wizard.utils.mixin(t,e);var n=t.$buttons.length,a=(t.$parent.width(),(t.$parent.width()-20*n)/n);t.$buttons.css({"float":"left",margin:"10px","min-width":"146px",width:a,"max-width":"300px"})},inherit:function(e,t){var n=e;return n.prototype=t,n.prototype.constructor=e,new n},mixin:function(e){var t,n,a=arguments.length;if(1===a)return e;for(var i=1;a>i;i++){t=arguments[i];for(var r in t)n=t[r],void 0!==n&&(e[r]=t[r])}return e},forEach:t,type:function(t){return null===t?t+"":e[Object.prototype.toString.call(t)]||"object"},isFunction:function(e){return"function"===wizard.utils.type(e)},objectArrayRemoveItemByProperty:function(e,t,n){for(var a,i=0,r=e.length;r>i;++i)a=e[i],a&&a[t]===n&&(e.splice(i,1),i--)},dialog:function(){var e={};return function(t){return e[t]?e[t]:e[t]=new BC.showDialog(null,t)}}(),method:function(e,t,n){wizard.utils.isFunction(n)&&(e[t]=n)},optimisticLock:function(){var e,t=0,n=function(e,n){t===e&&n()};return{exec:function(a,i){i=i||0,clearTimeout(e),e=setTimeout(function(){n(++t,a)},i)}}},getElementsWithAttribute:function(e,t){if(!e||1!=e.nodeType)return[];var n=[];null!==e.getAttribute(t)&&n.push(e);for(var a=e.getElementsByTagName("*"),i=0,r=a.length;r>i;i++)null!==a[i].getAttribute(t)&&n.push(a[i]);return n},textContent:function(e,t){if(void 0!==e.nodeType&&1===e.nodeType){var n=e.textContent!==void 0?"textContent":"innerText";return t===void 0?e[n]:(e[n]=t,void 0)}},trim:function(e){return"string"===this.type(e)?e.trim?e.trim():e.replace(/^\s*|\s*$/g,""):void 0},arrayForEach:t}}(),LinearProcessManager.prototype={constructor:LinearProcessManager,add:function(e){var t=Array.prototype.slice.call(arguments,1,arguments.length);return this._processes.push({process:e,param:t}),this},exec:function(){for(var e,t=this._processes,n=0,a=t.length;a>n;++n)t[n].param.push(t[n+1]);return e=t.shift(),e&&e.process.apply(this,e.param),this}},wizard.model=function(e){if(!e||"object"!=typeof e||wizard.util.isFunction(e.getParameter))throw Error("DataCenter is not available!");return{saveData:function(t,n){if(2==arguments.length)e.setParameter(t,n);else for(var a in t)e.setParameter(a,t[a])},getData:function(t){return e.getParameter(t)},removeData:function(t){if("object"!=typeof t)e.removeParameter(t);else for(var n in t)e.removeParameter(t[n])},updateDataCenter:function(e){var t=e.parameters;t&&this.saveData(t)}}},wizard.Subscription=function(e,t,n){this.stepId=n,this.isDisposed=!1,this.dispose=function(){this.isDisposed=!0,t&&t()},this.callback=e},wizard.pubSub=function(){var e={};return{subscribe:function(t,n,a){return wizard.utils.isFunction(a)?(!e[t]&&(e[t]=[]),e[t].push(new wizard.Subscription(a,function(){},n)),!0):!1},unSubscribe:function(t){for(var n in e)wizard.utils.objectArrayRemoveItemByProperty(e[n],"stepId",t)},publish:function(t,n){e[t]&&wizard.utils.arrayForEach(e[t].slice(),function(e){e&&e.isDisposed!==!0&&e.callback&&e.callback.call(null,n)})}}}(),wizard.portal=function(){var e,t={},n=function(e,t){return wizard.utils.isFunction(t)&&"string"==typeof e&&""!==wizard.utils.trim(e)?!0:!1};return{addPortal:function(e,a){var i=function(e,a){if(!n(e,a))throw new Exception("Portal should be a string and initiator should be a function.");t[e]=a};if("object"==typeof e)for(var r in e)i(r,e[r]);else i(e,a)},removePortal:function(e){return delete t[e]},initPortal:function(n){if(!t[n])throw new Exception("The portal does not exist.");t[e=n]()},getCurrentPortal:function(){return e}}}(),wizard.step=function(e){return new wizard.step.prototype._Init(e)},wizard.step.index=0,wizard.step.prototype={constructor:wizard.step,_Init:function(e){var t=!1,n=wizard.utils;if(this.getInited=function(){return t},this.inited=function(){return t=!0},this.reset=function(){return t=!1},this.index=wizard.step.index++,options=n.mixin({validate:null,init:null,begin:null,end:null,handle:null,i18n:null},e),"string"!=typeof options.id&&""===n.trim(options.id))throw Error("Step instance should have an property named id.");for(var a in options)this[a]=options[a]}},wizard.step.prototype._Init.prototype=wizard.step.prototype,wizard.adapters.stepBar=function(e){var t=wizard.utils.mixin({container:"#stepBarContainer",stepTitles:[]},e),n=function(){return $(t.container).stepbar({steps:t.stepTitles})},a=n();return{getInstance:function(){return a},splice:function(){if(2>arguments.length)throw Error("stepBar.instance should have more than two parameters.");var e=wizard.utils.type;if("number"!==e(arguments[0])||"number"!==e(arguments[1])||arguments[2]&&"string"!==e(arguments[2]))throw Error("stepBar.instance : wrong type of parameters.");Array.prototype.splice.apply(t.stepTitles,arguments),a=n()}}},wizard.adapters.fee=function(e){var t=wizard.model,n={container:"#fee",dsName:"rateDS",getRelevanceIdFunc:function(){return t.getData("domainId")},resourceAndCountMap:{cpu:t.getData("cpuCoreCount"),memory:t.getData("ramSize"),storage:t.getData("dataDiskSize")},getCountFunc:function(){return t.getData("applyCount")},i18n:{}};n=wizard.utils.mixin(!0,n,e);var a,i=$(container),r=function(){},o=function(e,t){a.addFee({name:n.i18n[e.resType],rate:e.ruleRate,num:t,unit:e.resUnit,isChargeable:!!e.resUnit})};return a=i.applyfee({locale:locale}),{getInstance:function(){return a},getDom:function(){return i},getRate:function(e){var t=dataCenter.getDataStore(n.getRelevanceIdFunc()+n.dsName);if(t){var a=t.getRowSet().getData();for(var i in a)if(a[i].resType==e)return a[i]}},updateCount:function(e){a.update({account:e})},handleFee:function(e,n){var a=this.getRate(e);a&&(t.getData("isAdmin")?o(a,n):r(a,n))},handleHistoryFee:function(e){var i=n.resourceAndCountMap;for(var r in i)a.addFee({name:n.i18n[String.prototype.toUpperCase.call(r)],rate:t.getData(r+"Rate"),num:i[r],unit:t.getData(r+"Unit"),isChargeable:!!t.getData(r+"Unit")});this.updateCount(n.getCountFunc()),e&&e.process.apply(this,e.param)}}},wizard.adapters.filter=function(e){var t=wizard.utils.mixin({gridId:"",filterAttr:"",idPrefix:"",unieap:r},e),n=t.filterAttr,a=t.gridId,i=t.idPrefix,r=t.unieap,o={};if(r&&wizard.utils.isFunction(r.byId)){var d=function(){var e;return function(){return e||(e=r.byId(a))}}(),s=function(){var e=[];for(var t in n)e.push(i+t.substring(0,1).toUpperCase()+t.substring(1,t.length));return e}(),u={INPUT:0,COMBOBOX:1},l=function(e,t){r.byId(e).getDataProvider().setDataStore(t)},c=function(e){var t=r.byId(e);t.getDataProvider().clear(),t.setText("")},f=function(e){e=e||{};var t=0;for(var a in n)n[a]==u.COMBOBOX&&l(s[t],e[a]),t++},p=function(e,t){if(e){var a={},i=e.getRowSet().getData();for(var d in n){var s=d;a[s]=new r.ds.DataStore(s),rowset=new r.ds.RowSet,rowset.insertRow({name:wizardProviders.wizardOptions.i18n.normal.comboboxAll,value:""}),$.each(i,function(e,t){var n=rowset.getData();for(var a in n)if(n[a].name==t[s])return!0;rowset.insertRow({name:t[s],value:t[s]})}),a[s].setRowSet(rowset)}return o[t]=a}},m=function(e){return e.replace(/(\.|\\|\^|\$|\*|\+|\?|\||\[|\]|\(|\)|\}|\{)/g,"\\$1")},g=function(e){var t=0;for(var a in n){if(a==e)break;t++}return n[e]==u.COMBOBOX?r.byId(s[t]):$("#"+s[t])},w=function(){var e,t,a=d().getManager("FilterManager");a.cancelFilter();for(var i in n){e=g(i);var r=e.getValue?e.getValue():m(e.val());t={},t.condition={},r&&"null"!=r&&(t.condition[i]={name:i,relation:n[i]==u.INPUT?"like":"=",value:r},t.pattern="${"+i+"}",a.setFilter(i,t))}a.doFilter()},h=function(){d().getManager("FilterManager").cancelFilter()},v=function(){var e;for(var t in n)e=g(t),e.onChange?e.onChange=function(e){w(),this.domNode.title=e}:(e.on("change",w),function(e){e.on("keyup",function(t){13==t.keyCode&&e.trigger("change")})}(e))};return v(),{bind:function(e,t){f(o[t]||p(e,t))},unbind:function(){f({});var e=0;for(var t in n)n[t]==u.COMBOBOX?c(s[e]):$(s[e]).val(""),e++},filter:w,cancelFilter:h}}},wizard.adapters.grid=function(e){var t=wizard.utils.mixin({unieap:n,gridId:"",loadDoneEvent:"ajaxdone"},e),n=t.unieap,a=t.gridId;if(n&&wizard.utils.isFunction(n.byId)){var i,r,o=function(){var e;return function(){return e||(e=n.byId(a))}}(),d=!1,s=function(){return i=o().getBinding().getDataStore(),i?i.getRowSet().getData():[]},u=function(e,t,n,a,i){var d=s();if("id"==t){var l=-1;for(var c in d)if(d[c].id==e){l=c;break}return-1!=l?(u(l,"","","",i),l):(wizard.utils.dialog.show("warn",n),-1)}return e=e||0,e>=d.length?(wizardOptions.dialog.show("warn",a),-1):(r=e,o().getManager("SelectionManager").setSelect(e),i&&i(e),e)},l=function(e){o().getManager("ViewManager").onRowClick({rowIndex:e})};return{getInstance:o,bind:function(e,t){t&&t(),o().getBinding().setDataStore(i=e)},unbind:function(){o().setDataStore(null)},i18n:function(e,t){_view.setHeaderName(e,t)},isLoaded:function(e){return e!==void 0?d=e:d},getDS:function(){return o().getBinding().getDataStore()},setDS:function(e){i=e},onRowClick:function(e){e&&(o().getViewManager().onRowClick=e)},getData:s,selectImmediate:u,select:function(e,n,a,i,r,o){var d=-1;this.isLoaded()?(d=u(e,n,a,i,o),d>-1&&l(d)):wizard.pubSub.subscribe(t.loadDoneEvent,function(t,s){s==r&&(d=u(e,n,a,i,o),d>-1&&l(d))})},getSelectRow:function(){var e=o().getManager("SelectionManager").getSelectedRows();return e&&e[0]},getSelectRows:function(){return o().getManager("SelectionManager").getSelectedRows()},clearSelection:function(){o().getManager("SelectionManager").clearSelection()},triggerClick:l,getSelectionManager:function(){return o().getManager("SelectionManager")}}}},wizard.adapters.slider=function(e){var t,n,a=(wizard.utils,$.extend(!0,{sliderId:"",inputId:"",rateCallback:null,sliderOptions:{range:"min",min:0,value:0,slide:function(e,n){d.val(t=parseFloat(n.value)),a.rateCallback&&a.rateCallback(t)},step:1}},e)),i=a.sliderOptions,r=a.rateCallback,o=$("#"+a.sliderId),d=$("#"+a.inputId),s=function(e){var n=i.minMoveValue||i.min,a=i.maxMoveValue||i.max;return isNaN(e)||(e+"").indexOf(".")>=0||"0"==(e+"").charAt(0)?d.val(t=n):n>e?d.val(t=n):e>a&&d.val(t=a),d.val(t=Math.round(t/i.step)*i.step),t},u=function(){o.slider(i),d.val(i.value||i.minMoveValue||i.min).trigger("change")};return d.off("keypress").on("keypress",function(e){(e.keycode>47||58>e.keycode)&&d.val(t)}).off("change").on("change",function(){o.slider("value",s(t=d.val())),r&&r(t)}),u(),{getSlider:function(){return o},disable:function(e){var a=o.parent();a.stop(!1,!0),a[e?"slideUp":"slideDown"](),r?r(t):n&&n(t),e?(r&&(n=r),r=null):n&&(r=n)},reset:function(e){e&&(i.value=e),u()},getValue:function(){return o.slider("option","value")}}},wizard.adapters.Switch=function(e){var t=$(e).bootstrapSwitch();this.getInstance=function(){return t}},wizard.providers.Switch.prototype={constructor:wizard.providers.Switch,setListener:function(e){this.getInstance().on("switch-change",e)},setStatus:function(e){this.getInstance().bootstrapSwitch("setState",!!e),this.trigger()},trigger:function(e){this.getInstance().trigger("switch-change",{value:e})}},wizard.adapters.carousel=function(e){var t=wizard.utils,e=t.mixin({container:".viewport",validate:null,beforeMove:null,afterMove:null},e),n=$(e.container),a=n.tinycarousel();return n.off("next").on("next",function(a,i){n.tinycarousel({validate:t.isFunction(e.validate)?!!e.validate(a,i):!0})}),t.isFunction(e.beforeMove)&&n.off("beforemove").on("beforemove",function(t,n){a.isLast()?wizard.pubSub.publish("enterLast"):wizard.pubSub.publish("leaveLast"),e.beforeMove(t,n)}),n.off("move").on("move",function(n,a){t.isFunction(e.afterMove)&&e.afterMove(n,a)}),{moveTo:function(e,t,n){var e=arguments[0];if(arguments[1])for(var i=0;e>=i;++i)a.move(i);else a.move(e,n)},getInstance:function(){return a},remove:function(e){a.getSlide(e).remove(),a.update()},getCurrentSlide:function(){return a.getCurrentSlide()},getIndex:function(){return a.getIndex()},getSlide:function(e){return a.getSlide(e)}}},wizard.handlers.Grid=function(e){var t=wizard.utils.mixin({gridId:"",stepId:"",dsName:"",loadURL:"",selectType:"click",filterHandler:null,getRelevanceIdFunc:null,afterAjaxDone:null,beforeBind:null,beforeRowClick:null,afterRowClick:null,beforeSelect:null,afterSelect:null,beforeDeselect:null,i18n:{}},e),n=this,a=new wizard.adapters.grid(t.gridId),i=a.getSelectionManager(),r=wizard.utils.model.getDataCenter();n.loadDS=function(e){var n=t.getRelevanceIdFunc;if(r.getDataStore((n&&n()||"")+t.dsName))return a.isLoaded(!0),wizard.pubSub.publish("ajaxdone",t.gridId),void 0;var i=function(i){var o=n&&n()||"";r.addDataStore(o+t.dsName,i.getDataStore(o+t.dsName)),a.isLoaded(!0),wizard.pubSub.publish("ajaxdone",t.gridId),e&&e.process.apply(this,e.param)};BC.ajax(t.loadURL,{},i)},n.init=function(){if("click"===t.selectType){var e=function(e){var n=e.rowIndex,i=a.getDS();if(i){var r=i.getRowSet().getData()[n],o=!0;t.beforeRowClick&&(o=t.beforeRowClick(r,n)),o!==!1&&(a.selectImmediate(n),t.afterRowClick&&t.afterRowClick(r))}};a.onRowClick(e)}t.beforeSelect&&(i.onBeforeSelect=t.beforeSelect),t.afterSelect&&(i.onAfterSelect=t.afterSelect),t.beforeDeselect&&(i.onBeforeDeselect=t.beforeDeselect),wizard.pubSub.subscribe("ajaxdone",t.gridId,function(e){e==t.gridId&&(t.afterAjaxDone&&t.afterAjaxDone(),n.bind())})},n.getData=a.getData,n.getDS=a.getDS,n.bind=function(){t.beforeBind&&t.beforeBind(),n.unbind();var e=t.getRelevanceIdFunc;a.bind(r.getDataStore((e&&e()||"")+t.dsName)),t.filterHandler&&t.filterHandler.bind(a.getDS(),e&&e()||t.gridId),a.clearSelection()},n.clearSelection=a.clearSelection,n.getSelectRow=a.getSelectRow,n.getSelectRows=a.getSelectRows,n.unbind=function(){a.unbind(),t.filterHandler&&t.filterHandler.unbind()},n.filter=function(){t.filterHandler.filter()},n.validate=function(){return!!a.getSelectRow()},n.getWarningText=function(){return a.isLoaded()?t.i18n.selectValidateInfo:t.i18n.isLoading},n.select=function(e,n){a.select(e,null,t.i18n.hasBeDeleted||"",t.i18n.noResource||"",t.gridId,n)},n.selectById=function(e,n){a.select(e,"id",t.i18n.hasBeDeleted||"",t.i18n.noResource||"",t.gridId,n)},n.selectImmediate=a.selectImmediate,n.isLoaded=function(){return a.isLoaded()},n.setOptions=function(e){t=$.extend(!0,t,e),t.beforeSelect&&(i.onBeforeSelect=t.beforeSelect),t.afterSelect&&(i.onAfterSelect=t.afterSelect),t.beforeDeselect&&(i.onBeforeDeselect=t.beforeDeselect)},n.getInstance=function(){return a.getInstance()}},wizard.handlers.resourceDelivery=function(e){var t={profileURL:"",canEditURL:"/dashboard/task!isCanWithDraw.action",submitURL:"",cancelURL:"",resubmitURL:"",discardURL:"",editBtnId:"edit",approveInfoPos:{titleContainerId:"stepTitleContainer",titleId:"stepTitle",feeId:"fee"},dataNames:{approveStatus:"approveStatus",approveInfo:"approveInfo",isCanWithDraw:"isCanWithDrawDS",workItemId:"workItemId"},stepTitleContainerId:"stepTitleContainer",locale:"zh_CN",beforeResubmit:null,i18n:{zh_CN:{AGREE:"同意：",DISAGREE:"驳回：",submitSuccess:"您的申请已提交成功，请等待管理员审批"},en_US:{AGREE:"Agree: ",DISAGREE:"Disagree: ",submitSuccess:"Your application is submitted, please wait for administrator's approval"}}},t=wizard.utils.mixin({},t,e);return t.i18n=t.i18n[locale],{getProfile:function(e){var n=function(t){wizard.model.updateDataCenter(t),e&&e.process.apply(this,e.param)};BC.ajax(t.profileURL,{},n,null,null,!0)},addApproveInfo:function(e){$("#"+t.stepTitleContainer+"#approveInfo").remove();var n=wizard.model,a=n.getData(t.dataNames.approveInfo),i=n.getData(t.dataNames.approveStatus);if(a&&i){a=t.i18n[i]+a;var r=20,o=$("#stepTitle"),d=200,s=$('<div id="approveInfo" title="'+a+'" style="float:left; color:#fc671e; font-size:14px; max-width:500px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">'+a+"</div>").insertAfter(o),u=$("#fee"),l=o.parent(),c=l.width()-d-u.outerWidth(),f=s.width();r=(c-f)/2,s.css({"margin-left":r,height:l.height(),"line-height":l.height()+4+"px"})}e&&e.process.apply(this,e.param)},canWithdraw:function(){var e=wizard.model,n=$("#"+t.editBtnId);n.hide();var a=function(a){dataCenter=a,n[e.getData(t.dataNames.isCanWithDraw)?"show":"hide"]()};BC.ajax(t.canEditURL,{workItemId:e.getData(t.dataNames.workItemId)},a,null,null,!0)},submit:function(){var e;if(t.beforeResubmit&&(e=t.beforeResubmit()),e){var n=function(){wizard.utils.dialog().show("success",t.i18n.submitSuccess,function(){window.history.back(-1)})};BC.ajax(t.submitURL,{},n,null,null,!0)}},resubmit:function(){var e;if(t.beforeResubmit&&(e=t.beforeResubmit()),e){var n=function(){wizard.utils.dialog().show("success",t.i18n.submitSuccess,function(){window.history.back(-1)})};BC.ajax(t.resubmitURL,{},n,null,null,!0)}},edit:function(){var e=function(){wizard.pubSub.publish("portalChanged","edit")};BC.ajax(t.cancelURL,{},e,null,null,!0)},discard:function(){var e=function(){window.history.back(-1)};BC.ajax(t.discardURL,{},e,null,null,!0)}}},wizard.handlers.button=function(e){var t=this,n=(wizard.model,wizard.utils.mixin({locale:"zh_CN",buttons:{next:"#next",prev:"#prev",submit:"#submit",cancel:"#cancel",edit:"#edit",resubmit:"#resubmit",discard:"#discard"},portalAction:{apply:function(){o.edit.obj.hide(),o.resubmit.obj.hide(),o.discard.obj.hide(),o.resubmit.status=-1},create:function(){o.edit.obj.hide(),o.resubmit.obj.hide(),o.discard.obj.hide(),o.resubmit.status=-1},edit:function(){o.next.obj.show(),o.prev.obj.show(),o.discard.obj.show(),o.edit.obj.hide(),o.submit.status=-1},history:function(){o.prev.obj.hide(),o.next.obj.hide(),o.submit.obj.hide(),o.resubmit.obj.hide(),o.discard.obj.hide(),o.edit.obj.show(),o.submit.status=-1,o.resubmit.status=-1}},i18n:{zh_CN:{next:"下一步",prev:"上一步",submit:"提交",cancel:"取消",edit:"编辑",resubmit:"重新提交",discard:"废弃"},en_US:{next:"Next",prev:"Previous",submit:"Submit",cancel:"Cancel",edit:"Edit",resubmit:"Resubmit",discard:"Discard"}}},e)),a=t.getBaseModule("resourceDelivery"),i=n.i18n[n.locale]||n.i18n,r=n.buttons,o={},d=function(e){switch(e){case"cancel":return function(){window.history.back(-1)};case"submit":return a.submit;case"edit":return a.edit;case"resubmit":return a.resubmit;case"discard":return a.discard}},s=function(){for(var e in r)o[e].status=0};for(var u in r)o[u]=o[u]||{},o[u].obj=$(r[u]).text(i[u]),o[u].status=0;$("#stepControlBtnGroup button").on("click",function(e){var t=d(e.target.id);t&&t()});var l=o.submit,c=o.resubmit;return wizard.pubSub.subscribe("enterLast","button",function(){-1!=l.status&&l.obj.show(),-1!=c.status&&c.obj.show()}),wizard.pubSub.subscribe("leaveLast","button",function(){-1!=l.status&&l.obj.hide(),-1!=c.status&&c.obj.hide()}),{switchBtn:function(){s();var e=n.portalAction[wizard.portal.getCurrentPortal()];wizard.utils.isFunction(e)&&e()}}},wizard.handlers.buttonGroup=function(e){var t,n=wizard.utils.mixin({stepId:"",container:"",loadDataURL:"",dsName:"",selectedEventName:"",ajaxDoneEventName:"",isDisabled:!1,dataValidate:function(){return!0},afterRendered:null,click:null,prompt:{noResource:"",resourceHasBeenDeleted:""}},e),a=$("#"+n.container),i=!1,r=function(){a.empty();var e=dataCenter.getDataStore(n.dsName);if(e){var i=e.getRowSet().getData(),r=[];null!=i&&($.each(i,function(e,t){r.push("<button type='button' class='btn' title='"+t.name+"'data-id='"+(n.getId?n.getId(t):t.id)+"'>"+BC.escapeBracketSymbol(t.name)+"</button>")}),t=$(r.join("")).appendTo(a),wizard.utils.adjustBtnGroupLayout({$parent:a,$buttons:t}))}},o=function(e,a){if("index"==a)e>=t.length?wizard.utils.dialog().show("warn",i18n.noResource):t.eq(e).trigger("click");else if("id"==a){var i=t.filter(function(){return $(this).data("id")==e});i&&1==i.length?i.addClass("active").trigger("click"):wizard.utils.dialog().show("warn",n.prompt.resourceHasBeenDeleted)}},d=function(e){return void 0===e?n.isDisabled:(n.isDisabled=e,a.find("button").not(".active")[e===!0?"addClass":"removeClass"]("disabled"),void 0)};return a.on("click","button",function(e){if(n.click){var t=n.click.apply(this,[e,a.find("button").index($(this))]);if(t===!1)return t;d()&&d(!0)}}),{loadData:function(e){var t=this,a=function(a){try{wizard.model.updateDataCenter(a),wizard.pubSub.publish("ajaxdone",n.ajaxDoneEventName),i=!0,r(),n.afterRendered&&n.afterRendered.apply(t),e&&e.process.apply(this,e.param)}catch(o){}};BC.ajax(n.loadDataURL,n.getLoadDataParams&&n.getLoadDataParams()||{},a)},validate:function(){return!!n.dataValidate()&&this.isLoaded()&&(!n.isDisabled&&a.find("button").filter(function(){return $(this).hasClass("active")}).length||n.isDisabled)},isLoaded:function(){return i},isSingleButton:function(){return 1==a.find("button").length},select:function(e,t,n){t=t||"index",o(e,t),n&&n.process.apply(this,n.param)},disable:d}},wizard.handlers.domain=function(e){var t=this,n=wizard.model,a=t.i18n,i=wizard.utils.mixin({stepId:this.id,containerId:"domainGroup",loadDataURL:"/singleTypeApply/singleTypeApplyofVMAction!getDomains.action",dsName:"domainDS",selectedEventName:"domainSelected",ajaxDoneEventName:"domain",isDisabled:!1,click:function(e,a){if($(this).hasClass("disabled"))return $("#selectDomain .description").addClass("alertInfo").text(t.i18n.cannotChangeDomain),!1;var r=dataCenter.getDataStore(i.dsName).getRowSet().getData()[a];n.saveData({domainId:r.id,domainName:r.name,domainDesc:r.desc,isAdmin:!!r.admin,targetDomainId:r.parentId}),$("#selectDomain .description").removeClass("alertInfo").text(r.desc),wizard.pubSub.publish(i.selectedEventName)},dataValidate:function(){var e=n.getData("domainId");return e!==void 0&&null!==e},prompt:{noResource:a.noDomain,resourceHasBeenDeleted:a.domainHasBeDeleted}},e),r=wizard.handlers.buttonGroup(i);return r.needToLoad=function(e){var t={template:n.getData("domainId"),network:(n.getData("isAdmin")?n.getData("targetDomainId"):n.getData("domainId"))+n.getData("dataCenterId")};return dataCenter.getDataStore(t[e]+e+"DS")?!1:!0},r},wizard.handlers.datacenter=function(e){var t=this,n=wizard.model,a=t.i18n,i=wizard.utils.mixin({stepId:t.id,containerId:"datacenterGroup",loadDataURL:"/resourceApp/resourceAppAction!getPools.action",whenLoad:function(){wizard.pubSub.subscribe("domainSelected",i.stepId,function(){(!t.getInited()||t.getInited()&&t.getBaseModule("carousel").getIndex()>=t.index)&&t.clear(),r.loadData()})},getId:function(e){return e.dataCenterId},getLoadDataParams:function(){return{currentDomainId:n.getData("domainId"),targetDomainId:n.getData("targetDomainId")}},dsName:"poolDS",selectedEventName:"datacenterSelected",ajaxDoneEventName:"datacenter",afterRendered:function(){var e=n.getData("dataCenterId");e?this.select(e,"id"):this.select(0,"index"),this.isSingleButton()&&t.removeStep()},click:function(e,t){var a=dataCenter.getDataStore(i.dsName).getRowSet().getData()[t];n.saveData({dataCenterId:a.dataCenterId,dataCenterName:a.dataCenterName,dataCenterDesc:a.description}),$("#"+i.containerId+" .description").removeClass("alertInfo").text(a.desc),wizard.pubSub.publish(i.selectedEventName)},dataValidate:function(){var e=n.getData("dataCenterId");return e!==void 0&&null!==e},prompt:{noResource:a.noDatacenter,resourceHasBeenDeleted:a.datacenterHasBeenDeleted}},e),r=wizard.handlers.buttonGroup(i);return wizard.utils.isFunction(i.whenLoad)&&i.whenLoad(),r.needToLoad=function(e){var t={template:n.getData("domainId"),network:(n.getData("isAdmin")?n.getData("targetDomainId"):n.getData("domainId"))+n.getData("dataCenterId")};return dataCenter.getDataStore(t[e]+e+"DS")?!1:!0},r},wizard.handlers.computeResource=function(e){var t,n,a=wizard.model,i=this,r=wizard.utils.mixin({cpuDomId:"cpuGroup",ramDomId:"ramGroup",computeRes:{cpus:[{value:1,mapRams:[.5,1,2]},{value:2,mapRams:[2,4,8]},{value:4,mapRams:[4,8,16]}]},onCPUClick:null,onRAMClick:null,onValidate:null,getCustomWarningText:null},e),o=$("#"+r.cpuDomId),d=$("#"+r.ramDomId),s=function(){var e=[];$.each(r.computeRes.cpus,function(t,n){var a=n.value+" "+i.i18n.cpuUnit;e.push("<button type='button' class='btn' title='"+a+"' data-count='"+n.value+"'>"+a+"</button>")}),o.empty().append(t=$(e.join("")))},u=function(e,t){var a=o.find("button"),s=[];s.length=0,$.each(r.computeRes.cpus[a.index($(e))].mapRams,function(e,n){var a=n+" "+i.i18n.ramUnit;s.push("<button type='button' class='btn"+(n===t?" active":"")+"' title='"+a+"' data-count='"+n+"'>"+a+"</button>")}),d.empty().append(n=$(s.join(""))),d.find("button.active").trigger("change",t)};return o.on("change click","button",function(e,t){var n=$(this).data("count");a.saveData("cpuCoreCount",n);var i=this.getBaseModule("fee");i&&(i.handleFee("CPU",parseFloat(n)),i.handleFee("MEMORY",0));var o=this;u(o,t),r.onCPUClick&&r.onCPUClick(n)}),d.on("change click","button",function(e,t){var n=$(this).data("count");a.saveData("ramSize",parseFloat(n));var i=this.getBaseModule("fee");i&&i.handleFee("MEMORY",n),r.onRAMClick&&r.onRAMClick(t)}),_getValue=function(){return{cpu:t.filter(".active").data("count"),ram:n.filter(".active").data("count")}},s(),{validate:function(){var e=_getValue(),t=e.cpu,n=e.ram;a.saveData({cpuCoreCount:t,ramSize:parseFloat(n)});var i=!(!t||!n);return r.onValidate?r.onValidate()&&i:i},select:function(e,n){t.filter(function(){return $(this).data("count")==e}).addClass("active").trigger("change",n).siblings().removeClass("active")},getValue:_getValue,getWarningText:function(){return r.getCustomWarningText&&r.getCustomWarningText()||i.i18n.configComputeResValidateInfo},setOptions:function(e){r=wizard.utils.mixin(r,e)}}},wizard.handlers.network=function(e){var t=this,n=wizard.utils,a=wizard.model,i=!1,r=function(){a.removeData(["networkId","networkName"])},o=n.mixin({gridId:"networkGrid",sliderId:"sliderId",bandwidthSwitchId:"isbandWidthLimited",dsName:"networkDS",loadURL:"/cloudapp/cloudappCreationAndApplyAction!getNetwork.action",whenLoad:null,filterHandler:null,getRelevanceIdFunc:function(){return a.getData(a.getData("isAdmin")?"targetDomainId":"domainId")+a.getData("dataCenterId")},afterAjaxDone:r,beforeRowClick:function(e,t){return f(t)?void 0:!1},afterRowClick:function(e){a.saveData({networkId:e.id,networkName:e.name})},beforeBind:c,i18n:{isLoading:t.i18n.networkIsLoading,selectValidateInfo:t.i18n.selectNetworkValidateInfo,hasBeDeleted:t.i18n.networkHasBeDeleted,noResource:t.i18n.noNetwork}},e),d=n.inherit(function(){this.init()},new wizard.handlers.Grid(o)),s=new wizard.providers.Switch(o.bandwidthSwitchId),u=wizard.providers.slider({sliderId:"bandWidthSlider",inputId:"bandWidthValue",rateCallback:function(e){a.getData("isbandWidthLimited")!==!1&&(e=0),a.saveData("bandwidth",parseFloat(e))},sliderOptions:{max:100,minMoveValue:10,value:10,step:10,scales:[10,20,50,100]}}),l=function(e){return d.getDS().getRowSet().getData()[e]},c=function(){d.getData().sort(function(e,t){return t.freeIP-e.freeIP})},f=function(e){if(void 0!==e){var a=d.getData()[e];if(a.usedIP>=a.totalIP)return d.clearSelection(),n.dialog.show("warn",t.i18n.no_free_ip),!1}return!0},p=function(){for(var e=-1,t=d.getData(),n=t.length,a=0;n>a;++a)if(t[a].usedIP<t[a].totalIP){e=a;break}return e};return s.setListener(function(e,t){a.saveData("isbandWidthLimited",!t.value),u.disable(!t.value)}),s.setStatus(i),n.isFunction(o.whenLoad)&&o.whenLoad(function(){t.getInited()&&t.getBaseModule("carousel").getIndex()>=t.index&&t.clear(),d.loadDS()}),{getGrid:function(){return d},getSlider:function(){return u},reset:function(e,t){s.setStatus(e),s.trigger(e),u.reset(t)},select:function(e,t){"id"===t?d.selectById(e):d.select(e)},detectAvailableNetworkIndex:function(){var e=p();return-1==e?(wizard.utils.dialog().show("warn",t.i18n.no_available_network),!1):e},unbind:d.unbind,getDataByIndex:l,getSelectRows:d.getSelectRows,canSelect:f,isLoaded:d.isLoaded,load:function(){d.loadDS()},needAutoLoaded:function(){return!o.whenLoad},hideCell:function(e){BC.hideCell([e],d.getInstance())}}},wizard.handlers.summary=function(){var e=this,t=wizard.model,n={},a=function(){n={};var a=e.data;for(var i in a){var r=t.getData(i);void 0!==e.i18n.items[i]&&(n[e.i18n.items[i]]=r===void 0?"":e.i18n.values[r]||r)}},i=function(){$("#infoSummary tr").remove(),a();var e=[];for(var t in n)e.push('<tr><td class = "title basicInfoLabel">'+t+"</td><td></td><td id=sum_"+t+' class="description basicInfoValue">'+n[t]+"</td></tr>");$(e.join("")).appendTo($("#infoSummary table"))};return i(),{initScroll:function(){$(".scroll-pane").jScrollPane()},updateSummary:function(){a();for(var e in n)$("#sum_"+e).text(n[e]);this.initScroll()},modify:function(t,n){switch(t){case"remove":if(n instanceof Array)for(var a in n)delete e.data[n[a]],delete e.i18n[n[a]];else delete e.data[n],delete e.i18n[n]}i()}}},wizard.steps.domain={id:"selectDomain",validate:function(){var e=this;return{validate:e.handle.validate(),showWarning:!0,warningText:function(){return e.handle.isLoaded()?e.i18n.selectDomainValidateInfo:e.i18n.domainIsLoading}}},init:function(){var e,t=this,n=wizard.model.getData("domainId"),a=new wizard.LinearProcessManager,i=this.handle.select;e="EDIT"!==wizard.getCurrentPortal()?[0,"index"]:[n,"id"],a.add(this.handle.loadData),n?a.add(i,n,"id"):a.add(i,0,"index"),a.add(function(){t.handle.isSingleButton()&&t.removeStep()}).exec()},handle:wizard.handlers.domain,i18n:{zh_CN:{title:"选择域",titleText:"您属于多个域，请选择在哪个域申请负载均衡",domainIsLoading:"正在加载域，请稍候",selectDomainValidateInfo:"请选择域",cannotChangeDomain:"编辑申请单时不能变更申请域",domainHasBeenDeleted:"您申请的域已不存在(您可能已经被管理员移出该域)"},en_US:{title:"Select Domain",titleText:"You belong to multiple domain, please choose one.",domainIsLoading:"Domain data is loading, please wait a moment",selectDomainValidateInfo:"Please select a domain",cannotChangeDomain:"You can not change the domain when editing the application form",domainHasBeenDeleted:"The domain you applied is not existed"}},clear:function(){wizard.model.removeData(["domainId","domainName","domainDesc","isAdmin"])}},wizard.steps.datacenter={id:"selectDatacenter",validate:function(){var e=this;return{validate:e.handle.validate(),showWarning:!0,warningText:function(){return e.handle.isLoaded()?e.i18n.selectDatacenterValidateInfo:e.i18n.datacenterIsLoading}}},handle:wizard.handlers.datacenter,i18n:{zh_CN:{title:"选择数据中心",titleText:"您属于多个数据中心，请选择在哪个数据中心申请负载均衡",datacenterIsLoading:"正在加载数据中心，请稍候",selectDatacenterValidateInfo:"请选择数据中心",datacenterHasBeenDeleted:"您申请的数据中心已不存在(您可能已经被管理员移出该数据中心)"},en_US:{title:"Select Datacenter",titleText:"You belong to multiple datacenters, please choose one.",datacenterIsLoading:"datacenter data is loading, please wait a moment",selectDatacenterValidateInfo:"Please select a datacenter",datacenterHasBeenDeleted:"The datacenter you applied is not existed"}},clear:function(){wizard.model.removeData(["dataCenterId","dataCenterName","dataCenterDesc"])}},wizard.steps.computeRes={id:"configComputeRes",validate:function(){var e=this.handle;return{validate:e.validate(),showWarning:!0,warningText:e.getWarningText()}},init:function(){var e=wizard.model,t=e.getData("cpuCoreCount")||2,n=e.getData("ramSize")||4;this.handle.select(t,n)},end:function(){var e=this;model.saveData({cpuText:model.getData("cpuCoreCount")+e.i18n.cpuUnit,ramText:model.getData("ramSize")+e.i18n.ramUnit})},handle:wizard.handlers.computeRes,i18n:{zh_CN:{title:"配置计算资源",cpuTitle:"CPU",ramTitle:"RAM",cpuUnit:"核心",ramUnit:"GB"},en_US:{title:"Configure Compute",cpuTitle:"CPU",ramTitle:"RAM",cpuUnit:"Core",ramUnit:"GB"}},clear:function(){wizard.model.removeData(["cpuCoreCount","ramSize"])}},wizard.steps.network={id:"configNetwork",init:function(){var e,t=wizard.model.getData("bandwidth"),n=wizard.model.getData("networkId"),a=this.handle,i=new wizard.LinearProcessManager,r=function(){(e=a.detectAvailableNetworkIndex())!==!1&&(n?a.select(n,"id"):a.select(e))};a.reset(!!t,t),a.needAutoLoaded()&&i.add(a.getGrid().loadDS),i.add(r).exec()
},end:function(){var e=wizard.model,t=this;e.saveData({bandwidthText:e.getData("isbandwidthLimited")?t.i18n.unlimited:e.getData("bandwidth")+t.i18n.bandWidthUnit})},validate:function(){var e=this;return{validate:function(){var t=e.handle.getGrid().getSelectRow();return!!t&&t.data.totalIP-t.data.usedIP>=0}(),showWarning:!0,warningText:e.handle.getGrid().getWarningText()}},clear:function(){wizard.model.removeData(["networkId"])},handle:wizard.handlers.network,i18n:{zh_CN:{title:"配置网络",requiredPublicIPTitle:"需要公共IP",requiredPublicIPDesc:"有公共IP的机器可以直接通过公共IP访问",isbandWidthLimitedTitle:"带宽限制",isbandWidthLimitedDesc:"外部访问该应用节点所进行的流量限制",bandWidthUnit:"Mbps",networkTitle:"网络",grid:{gridId:"networkGrid",name:"网络名称",startIP:"起始IP",endIP:"终止IP",mask:"子网掩码",gateway:"网关",vlan:"VLAN",usage:"IP使用情况"},networkIsLoading:"正在加载网络，请稍候",selectNetworkValidateInfo:"请选择可用网络",networkHasBeDeleted:"您申请时选择的网络已不存在，请重新选择",noNetwork:"无可用网络",no_free_ip:"该网络无空闲IP",no_available_network:"无可用网络",unlimited:"无限制"},en_US:{title:"Configure Network",requiredPublicIPTitle:"Required Public IP",requiredPublicIPDesc:"The VM who has public IP can be accessed through the IP",isbandWidthLimitedTitle:"Bandwidth Limitation",isbandWidthLimitedDesc:"Traffic limitation of the external access of nodes",bandWidthUnit:"Mbps",networkTitle:"Network",grid:{gridId:"networkGrid",name:"Name",startIP:"Start IP",endIP:"End IP",mask:"Subnet Mask",gateway:"Gateway",vlan:"VLAN",usage:"IP Usage"},networkIsLoading:"Network data is loading, please wait a moment",selectNetworkValidateInfo:"Please select a available network",networkHasBeDeleted:"The network you selected is not existed",noNetwork:"There is no available network",no_free_ip:"There is no free IP in selected network",no_available_network:"There is no available network",unlimited:"Unlimited"}}},wizard.steps.summary={id:"infoSummary",data:{domainName:"",dataCenterName:"",name:"",applyCount:0,networkName:"",bandwidthText:"",deadline:"",purposeDesc:"",comment:""},begin:function(){this.handle.updateSummary()},handle:wizard.handlers.summary,i18n:{zh_CN:{title:"信息确认",items:{domainName:"域",dataCenterName:"数据中心",name:"名称",networkName:"网络",bandwidthText:"带宽",applyCount:"数量",deadline:"到期时间",purposeDesc:"用途描述",comment:"备注"},values:{unlimited:"无限制"}},en_US:{title:"Information Summary",items:{domainName:"Domain",dataCenterName:"Data Center",name:"Name",networkName:"Network",bandwidthText:"Bandwidth",applyCount:"Count",deadline:"Deadline",purposeDesc:"Description",comment:"Comment"},values:{unlimited:"Unlimited"}}}},wizard.init=function(e){return new wizard.init.prototype._Init(e)},wizard.init.prototype={constructor:wizard.init,_Init:function(e){var t=wizard.utils,n=t.mixin({locale:"zh_CN",steps:[],titleContainer:"#stepTitle",dataCenter:{}},e);if(!n.titleContainer||!n.titleContainer.nodeType)throw Error("Init : titleContainer should be a DOM Object!");var a,i,r={},o={},d=[],s=!1,u=window.jQuery,l=function(e){for(var t in r)if(r[t].index==e)return r[t]};wizard.model=wizard.model(n.model),this.getBaseModule=function(e){if("string"!=typeof e||""===t.trim(e))throw Error("getBaseModule : Id of module should be a non-null string value!");return o[e]},this.getStep=function(e){return"string"!==t.type(e)&&""!==t.trim(e)?null:r[e]},this.removeStep=function(e){var t=this.getStep(e),o=t.index;if(t){for(var s in r)r[s].index>o&&r[s].index--;return i.splice(o,1),a.getIndex()===o&&n.titleContainer.textContent(d[o]||""),a.remove(o),wizard.pubSub.unSubscribe(e),delete r[e]}},a=wizard.adapters.carousel({validate:function(e,n){var a,i=!0,r=l(n);return r.validate&&(a=r.validate(),i=a.validate,!i&&a.showWarning&&t.dialog().show("warn",a.warningText)),i},beforeMove:function(e,t){var a,i;u?(a=$(n.titleContainer),$.fn.customShow=function(){return this.fadeIn({duration:500,queue:!1}),this},$().is(":animated")&&a.stop(),a.hide().text(d[t.i])[t.animate?"customShow":"show"]()):n.titleContainer.textContent(d[t.i]),i=l(t.i),currentStepInst=l(t.i-1),currentStepInst&&currentStepInst.getInited()&&currentStepInst.end&&currentStepInst.end(),i&&(!i.getInited()&&i.inited()&&i.init&&i.init(),i.begin&&i.begin())},afterMove:function(e,t){i.getInstance().stepTo(t)}}),s=!0,i=wizard.adapters.stepBar({stepTitles:d}),this.addBaseModule({carousel:a,stepBar:i}),this.addSteps(n.steps);var c=this;wizard.pubSub.subscribe("portalChanged","global",function(e){c.route(e)})},addBaseModule:function(e){var t;if(1===arguments.length){if("object"!==utils.type(e)||"string"==typeof e&&""===utils.trim(e))throw Error("addBaseModules : wrong parameters");t=e;for(var n in t)t.hasOwnProperty(n)&&_addBaseModule(n,t[n])}else{if(2!==arguments.length)throw Error("addBaseModules : wrong arguments");_addBaseModule(e,handler)}},addSteps:function(e){for(var t,n=0,a=e.length;a>n;++n)t=e[n],"object"===utils.type(t)&&("object"===utils.type(t.step)?(t.step=wizard.step(t.step),_addStep(t.step.id,t.step,t.options)):(t=wizard.step(t),_addStep(t.id,t)))},route:function(e){var t=this.getBaseModule("carousel"),n=this.getBaseModule("button");if(!t)throw Error("carouselHandler should be registered!");wizard.portal.initPortal(e),wizard.pubSub.publish("route"),n&&n.switchBtn(e)}},wizard.init.prototype._Init.prototype=wizard.init.prototype;